<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - gen.aditor.ai</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            dark: {
              bg: '#0a0a0a',
              card: '#111111',
              border: '#222222',
              hover: '#1a1a1a'
            }
          }
        }
      }
    }
  </script>
  <style>
    body {
      background-color: #0a0a0a;
      color: #ffffff;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  
  <!-- Header -->
  <header class="border-b border-dark-border">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <a href="/" class="text-2xl font-bold text-orange-500">
          gen.aditor.ai
        </a>
        <div class="flex items-center gap-6">
          <a href="/" class="text-sm text-gray-400 hover:text-white transition">
            Open Workflows
          </a>
          <div class="flex items-center gap-3">
            <div class="text-right">
              <div id="user-name" class="text-sm font-medium text-white"></div>
              <div id="user-plan" class="text-xs text-gray-400"></div>
            </div>
            <button id="logout-btn" class="text-sm text-gray-400 hover:text-red-400 transition">
              Logout
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 container mx-auto px-6 py-12">
    
    <!-- Welcome Section -->
    <div class="mb-12">
      <h1 class="text-4xl font-bold mb-2">Welcome back, <span id="welcome-name"></span>!</h1>
      <p class="text-gray-400">Here's your creative production overview</p>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
      
      <!-- Usage Card -->
      <div class="bg-dark-card border border-dark-border rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-sm font-medium text-gray-400">Workflow Runs</h3>
          <span class="text-2xl">ğŸ¬</span>
        </div>
        <div class="text-3xl font-bold mb-2" id="usage-current">0</div>
        <div class="flex items-center gap-2 text-sm">
          <div class="flex-1 bg-dark-bg rounded-full h-2">
            <div id="usage-bar" class="bg-orange-500 h-2 rounded-full transition-all" style="width: 0%"></div>
          </div>
          <span class="text-gray-500" id="usage-limit">/ 0</span>
        </div>
        <p class="text-xs text-gray-500 mt-3">Resets monthly</p>
      </div>

      <!-- Plan Card -->
      <div class="bg-dark-card border border-dark-border rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-sm font-medium text-gray-400">Current Plan</h3>
          <span class="text-2xl">âš¡</span>
        </div>
        <div class="text-3xl font-bold mb-2 capitalize" id="plan-name">-</div>
        <div class="text-sm text-gray-400 mb-4" id="plan-status">Active</div>
        <button id="manage-billing-btn" class="text-sm text-orange-500 hover:text-orange-400 transition">
          Manage Billing â†’
        </button>
      </div>

      <!-- Trial Card (if applicable) -->
      <div id="trial-card" class="bg-gradient-to-br from-orange-500/10 to-orange-500/5 border border-orange-500/30 rounded-xl p-6 hidden">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-sm font-medium text-orange-400">Free Trial</h3>
          <span class="text-2xl">ğŸ‰</span>
        </div>
        <div class="text-3xl font-bold mb-2 text-orange-500" id="trial-days">0 days</div>
        <div class="text-sm text-gray-400 mb-4">remaining in your trial</div>
        <button id="upgrade-btn" class="w-full bg-orange-500 hover:bg-orange-600 text-white text-sm font-semibold py-2 rounded-lg transition">
          Upgrade Now
        </button>
      </div>

      <!-- Active Plan Card (if not trial) -->
      <div id="active-card" class="bg-dark-card border border-dark-border rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-sm font-medium text-gray-400">Time Saved</h3>
          <span class="text-2xl">â±ï¸</span>
        </div>
        <div class="text-3xl font-bold mb-2" id="time-saved">0h</div>
        <div class="text-sm text-gray-400">this month</div>
        <p class="text-xs text-gray-500 mt-3">Based on average workflow times</p>
      </div>

    </div>

    <!-- Quick Actions -->
    <div class="mb-12">
      <h2 class="text-2xl font-bold mb-6">Quick Actions</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        
        <!-- Kickstarter -->
        <a href="/?workflow=kickstarter" class="group bg-dark-card border border-dark-border rounded-xl p-6 hover:border-orange-500/50 transition">
          <div class="text-3xl mb-4">ğŸš€</div>
          <h3 class="text-lg font-semibold mb-2 group-hover:text-orange-500 transition">Kickstarter</h3>
          <p class="text-sm text-gray-400">Product scraping â†’ brolls + badges</p>
        </a>

        <!-- Image Ads -->
        <a href="/?workflow=image-ads" class="group bg-dark-card border border-dark-border rounded-xl p-6 hover:border-orange-500/50 transition">
          <div class="text-3xl mb-4">ğŸ¨</div>
          <h3 class="text-lg font-semibold mb-2 group-hover:text-orange-500 transition">Image Ads</h3>
          <p class="text-sm text-gray-400">Product + inspo â†’ 8 new ads</p>
        </a>

        <!-- Script â†’ Explainer -->
        <a href="/?workflow=script-explainer" class="group bg-dark-card border border-dark-border rounded-xl p-6 hover:border-orange-500/50 transition">
          <div class="text-3xl mb-4">ğŸ“œ</div>
          <h3 class="text-lg font-semibold mb-2 group-hover:text-orange-500 transition">Script â†’ Explainer</h3>
          <p class="text-sm text-gray-400">Script analysis â†’ consistent frames</p>
        </a>

        <!-- Screenshot â†’ Broll -->
        <a href="/?workflow=screenshot-broll" class="group bg-dark-card border border-dark-border rounded-xl p-6 hover:border-orange-500/50 transition">
          <div class="text-3xl mb-4">ğŸ“¸</div>
          <h3 class="text-lg font-semibold mb-2 group-hover:text-orange-500 transition">Screenshot â†’ Broll</h3>
          <p class="text-sm text-gray-400">Competitor ads â†’ recreations</p>
        </a>

        <!-- Selection + Queue -->
        <a href="/?tab=queue" class="group bg-dark-card border border-dark-border rounded-xl p-6 hover:border-orange-500/50 transition">
          <div class="text-3xl mb-4">ğŸ¬</div>
          <h3 class="text-lg font-semibold mb-2 group-hover:text-orange-500 transition">Video Queue</h3>
          <p class="text-sm text-gray-400">Convert images â†’ videos</p>
        </a>

        <!-- Account Settings -->
        <a href="#settings" class="group bg-dark-card border border-dark-border rounded-xl p-6 hover:border-orange-500/50 transition">
          <div class="text-3xl mb-4">âš™ï¸</div>
          <h3 class="text-lg font-semibold mb-2 group-hover:text-orange-500 transition">Settings</h3>
          <p class="text-sm text-gray-400">Manage your account</p>
        </a>

      </div>
    </div>

    <!-- Recent Activity (placeholder) -->
    <div>
      <h2 class="text-2xl font-bold mb-6">Recent Activity</h2>
      <div class="bg-dark-card border border-dark-border rounded-xl p-8 text-center">
        <div class="text-gray-500 mb-4">
          <span class="text-4xl">ğŸ“Š</span>
        </div>
        <p class="text-gray-400">Your recent workflow runs will appear here</p>
        <button class="mt-4 text-sm text-orange-500 hover:text-orange-400 transition">
          View Full History â†’
        </button>
      </div>
    </div>

  </main>

  <!-- Footer -->
  <footer class="border-t border-dark-border py-6">
    <div class="container mx-auto px-6 text-center text-sm text-gray-500">
      <p>&copy; 2026 Aditor Inc. All rights reserved.</p>
      <div class="mt-2 space-x-4">
        <a href="/privacy.html" class="hover:text-gray-400 transition">Privacy</a>
        <a href="/terms.html" class="hover:text-gray-400 transition">Terms</a>
        <a href="mailto:support@aditor.ai" class="hover:text-gray-400 transition">Support</a>
      </div>
    </div>
  </footer>

  <script>
    // Check authentication
    const token = localStorage.getItem('access_token');
    if (!token) {
      window.location.href = '/login.html';
    }

    // Load user data
    async function loadUserData() {
      try {
        const response = await fetch('/api/auth/me', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (!response.ok) {
          throw new Error('Authentication failed');
        }

        const data = await response.json();
        const user = data.user;

        // Update UI with user data
        document.getElementById('user-name').textContent = user.name;
        document.getElementById('welcome-name').textContent = user.name.split(' ')[0];
        document.getElementById('user-plan').textContent = user.plan.charAt(0).toUpperCase() + user.plan.slice(1);
        document.getElementById('plan-name').textContent = user.plan;
        document.getElementById('plan-status').textContent = user.status === 'trial' ? 'Free Trial' : 'Active';

        // Usage stats
        document.getElementById('usage-current').textContent = user.usage.current;
        document.getElementById('usage-limit').textContent = `/ ${user.usage.limit}`;
        const usagePercent = (user.usage.current / user.usage.limit) * 100;
        document.getElementById('usage-bar').style.width = `${usagePercent}%`;

        // Time saved calculation (rough estimate: 30-50h saved per month at full usage)
        const avgTimeSaved = (user.usage.current * 0.5); // 30 min per workflow average
        document.getElementById('time-saved').textContent = `${Math.round(avgTimeSaved)}h`;

        // Trial card
        if (user.status === 'trial' && user.trial_end) {
          const now = Math.floor(Date.now() / 1000);
          const daysLeft = Math.ceil((user.trial_end - now) / 86400);
          if (daysLeft > 0) {
            document.getElementById('trial-card').classList.remove('hidden');
            document.getElementById('active-card').classList.add('hidden');
            document.getElementById('trial-days').textContent = `${daysLeft} days`;
          }
        }

      } catch (error) {
        console.error('Failed to load user data:', error);
        // Invalid token, redirect to login
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        localStorage.removeItem('user');
        window.location.href = '/login.html';
      }
    }

    // Logout
    document.getElementById('logout-btn').addEventListener('click', async () => {
      try {
        const refreshToken = localStorage.getItem('refresh_token');
        if (refreshToken) {
          await fetch('/api/auth/logout', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ refresh_token: refreshToken })
          });
        }
      } catch (error) {
        console.error('Logout error:', error);
      }
      
      // Clear local storage and redirect
      localStorage.removeItem('access_token');
      localStorage.removeItem('refresh_token');
      localStorage.removeItem('user');
      window.location.href = '/login.html';
    });

    // Manage billing (Stripe Customer Portal)
    document.getElementById('manage-billing-btn').addEventListener('click', async () => {
      try {
        const response = await fetch('/api/stripe/portal', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        const data = await response.json();
        if (data.url) {
          window.location.href = data.url;
        }
      } catch (error) {
        console.error('Failed to open billing portal:', error);
        alert('Failed to open billing portal. Please contact support.');
      }
    });

    // Upgrade button
    const upgradeBtn = document.getElementById('upgrade-btn');
    if (upgradeBtn) {
      upgradeBtn.addEventListener('click', () => {
        window.location.href = '/signup.html?upgrade=true';
      });
    }

    // Load data on page load
    loadUserData();
  </script>

</body>
</html>
