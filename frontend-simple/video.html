<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aditor Video Gen - Veo 3</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#fff7ed',
              100: '#ffedd5',
              200: '#fed7aa',
              300: '#fdba74',
              400: '#fb923c',
              500: '#f97316',
              600: '#ea580c',
              700: '#c2410c',
              800: '#9a3412',
              900: '#7c2d12',
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
  
  <!-- Header -->
  <header class="bg-gray-800 border-b border-gray-700">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg flex items-center justify-center font-bold text-xl">
            A
          </div>
          <div>
            <h1 class="text-xl font-bold">Aditor Video Gen</h1>
            <p class="text-sm text-gray-400">Powered by Veo 3</p>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <a href="index.html" class="text-sm text-gray-400 hover:text-white">‚Üê Back to Images</a>
          <div class="text-right">
            <div class="text-xs text-gray-400">Status</div>
            <div class="flex items-center space-x-2">
              <span id="status-indicator" class="w-2 h-2 bg-gray-500 rounded-full"></span>
              <span id="status-text" class="text-sm font-medium">Checking...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-6 py-8 max-w-4xl">
    
    <!-- Generation Form -->
    <div class="bg-gray-800 rounded-xl p-8 mb-8">
      <h2 class="text-2xl font-bold mb-6">Generate Video</h2>
      
      <form id="video-form" class="space-y-6">
        <!-- Input Mode Toggle -->
        <div class="flex space-x-4 mb-4">
          <button type="button" id="prompt-mode-btn" class="flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium">
            Prompt
          </button>
          <button type="button" id="script-mode-btn" class="flex-1 px-4 py-2 bg-gray-700 text-gray-300 rounded-lg font-medium hover:bg-gray-600">
            Script
          </button>
        </div>

        <!-- Prompt Input -->
        <div id="prompt-input" class="space-y-2">
          <label class="block text-sm font-medium text-gray-300">Video Prompt</label>
          <textarea 
            id="prompt" 
            rows="4" 
            class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-white placeholder-gray-400"
            placeholder="Professional product shot of smartphone, smooth camera zoom in, well-lit studio environment, clean background..."
          ></textarea>
          <p class="text-xs text-gray-400">Describe the video you want to create. Be specific about camera movements, lighting, and visual style.</p>
        </div>

        <!-- Script Input (hidden by default) -->
        <div id="script-input" class="space-y-2 hidden">
          <label class="block text-sm font-medium text-gray-300">Ad Script</label>
          <textarea 
            id="script" 
            rows="6" 
            class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-white placeholder-gray-400"
            placeholder="[Product shot]
Introducing the new iPhone 15...
[Zoom to features]
With revolutionary camera technology...
[CTA]
Available now at Apple.com"
          ></textarea>
          <p class="text-xs text-gray-400">Paste your ad script. AI will extract visual cues and convert to video prompt.</p>
        </div>

        <!-- Duration -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-300">Duration</label>
          <div class="flex items-center space-x-4">
            <input 
              type="range" 
              id="duration" 
              min="5" 
              max="30" 
              value="5" 
              class="flex-1"
            >
            <span id="duration-value" class="text-lg font-semibold text-primary-500 w-16 text-right">5s</span>
          </div>
          <p class="text-xs text-gray-400">Longer videos take more time and cost more (~$0.10 per 5 seconds)</p>
        </div>

        <!-- Aspect Ratio -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-300">Aspect Ratio</label>
          <div class="grid grid-cols-3 gap-3">
            <button type="button" class="aspect-ratio-btn active px-4 py-3 bg-primary-600 border-2 border-primary-500 rounded-lg font-medium" data-ratio="9:16">
              9:16<br><span class="text-xs text-gray-300">Vertical</span>
            </button>
            <button type="button" class="aspect-ratio-btn px-4 py-3 bg-gray-700 border-2 border-gray-600 rounded-lg font-medium hover:border-gray-500" data-ratio="16:9">
              16:9<br><span class="text-xs text-gray-400">Horizontal</span>
            </button>
            <button type="button" class="aspect-ratio-btn px-4 py-3 bg-gray-700 border-2 border-gray-600 rounded-lg font-medium hover:border-gray-500" data-ratio="1:1">
              1:1<br><span class="text-xs text-gray-400">Square</span>
            </button>
          </div>
        </div>

        <!-- Cost Estimate -->
        <div class="bg-gray-700 rounded-lg p-4">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-sm text-gray-400">Estimated Cost</div>
              <div class="text-2xl font-bold text-primary-500">$<span id="cost-estimate">0.10</span></div>
            </div>
            <div class="text-right">
              <div class="text-sm text-gray-400">Processing Time</div>
              <div class="text-lg font-semibold">~<span id="time-estimate">100</span>s</div>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <button 
          type="submit" 
          class="w-full bg-primary-600 hover:bg-primary-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span>Generate Video</span>
        </button>
      </form>
    </div>

    <!-- Active Job Status -->
    <div id="job-status" class="hidden bg-gray-800 rounded-xl p-8 mb-8">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold">Generating...</h3>
        <button id="cancel-job" class="text-sm text-gray-400 hover:text-white">Cancel</button>
      </div>
      
      <!-- Progress Bar -->
      <div class="mb-4">
        <div class="flex justify-between text-sm text-gray-400 mb-2">
          <span id="job-status-text">Processing</span>
          <span id="job-progress">0%</span>
        </div>
        <div class="w-full bg-gray-700 rounded-full h-2">
          <div id="progress-bar" class="bg-primary-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
        </div>
      </div>

      <!-- Job Details -->
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <div class="text-gray-400">Job ID</div>
          <div class="font-mono text-xs" id="job-id">-</div>
        </div>
        <div>
          <div class="text-gray-400">Elapsed Time</div>
          <div class="font-semibold" id="elapsed-time">0s</div>
        </div>
      </div>
    </div>

    <!-- Completed Video -->
    <div id="video-result" class="hidden bg-gray-800 rounded-xl p-8 mb-8">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold">Video Ready!</h3>
        <button id="generate-another" class="text-sm text-primary-500 hover:text-primary-400">Generate Another</button>
      </div>
      
      <div class="bg-black rounded-lg overflow-hidden mb-4">
        <video id="result-video" controls class="w-full"></video>
      </div>

      <div class="flex space-x-3">
        <a id="download-video" href="#" download class="flex-1 bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-6 rounded-lg text-center">
          Download Video
        </a>
        <button id="copy-url" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white font-medium rounded-lg">
          Copy URL
        </button>
      </div>
    </div>

    <!-- Recent Videos -->
    <div class="bg-gray-800 rounded-xl p-8">
      <h2 class="text-xl font-bold mb-6">Recent Videos</h2>
      <div id="recent-videos" class="space-y-3">
        <p class="text-gray-400 text-center py-8">No videos yet. Generate your first one!</p>
      </div>
    </div>

  </main>

  <script>
    const API_BASE = window.location.origin;
    let currentJobId = null;
    let pollInterval = null;
    let startTime = null;

    // DOM Elements
    const form = document.getElementById('video-form');
    const promptModeBtn = document.getElementById('prompt-mode-btn');
    const scriptModeBtn = document.getElementById('script-mode-btn');
    const promptInput = document.getElementById('prompt-input');
    const scriptInput = document.getElementById('script-input');
    const durationSlider = document.getElementById('duration');
    const durationValue = document.getElementById('duration-value');
    const costEstimate = document.getElementById('cost-estimate');
    const timeEstimate = document.getElementById('time-estimate');
    const jobStatus = document.getElementById('job-status');
    const videoResult = document.getElementById('video-result');

    // Check API status
    async function checkStatus() {
      try {
        const res = await fetch(`${API_BASE}/health`);
        const data = await res.json();
        if (data.status === 'ok') {
          document.getElementById('status-indicator').className = 'w-2 h-2 bg-green-500 rounded-full animate-pulse';
          document.getElementById('status-text').textContent = 'Online';
        }
      } catch (error) {
        document.getElementById('status-indicator').className = 'w-2 h-2 bg-red-500 rounded-full';
        document.getElementById('status-text').textContent = 'Offline';
      }
    }

    // Toggle input mode
    promptModeBtn.addEventListener('click', () => {
      promptModeBtn.className = 'flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium';
      scriptModeBtn.className = 'flex-1 px-4 py-2 bg-gray-700 text-gray-300 rounded-lg font-medium hover:bg-gray-600';
      promptInput.classList.remove('hidden');
      scriptInput.classList.add('hidden');
    });

    scriptModeBtn.addEventListener('click', () => {
      scriptModeBtn.className = 'flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium';
      promptModeBtn.className = 'flex-1 px-4 py-2 bg-gray-700 text-gray-300 rounded-lg font-medium hover:bg-gray-600';
      scriptInput.classList.remove('hidden');
      promptInput.classList.add('hidden');
    });

    // Update estimates
    durationSlider.addEventListener('input', (e) => {
      const duration = parseInt(e.target.value);
      durationValue.textContent = `${duration}s`;
      
      // Cost: ~$0.10 per 5 seconds
      const cost = (duration / 5) * 0.10;
      costEstimate.textContent = cost.toFixed(2);
      
      // Processing time: ~20s per video second
      const time = duration * 20;
      timeEstimate.textContent = time;
    });

    // Aspect ratio selection
    document.querySelectorAll('.aspect-ratio-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        document.querySelectorAll('.aspect-ratio-btn').forEach(b => {
          b.className = 'aspect-ratio-btn px-4 py-3 bg-gray-700 border-2 border-gray-600 rounded-lg font-medium hover:border-gray-500';
        });
        btn.className = 'aspect-ratio-btn active px-4 py-3 bg-primary-600 border-2 border-primary-500 rounded-lg font-medium';
      });
    });

    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const isScriptMode = !scriptInput.classList.contains('hidden');
      const prompt = document.getElementById('prompt').value.trim();
      const script = document.getElementById('script').value.trim();
      const duration = parseInt(durationSlider.value);
      const aspectRatio = document.querySelector('.aspect-ratio-btn.active').dataset.ratio;

      if (!isScriptMode && !prompt) {
        alert('Please enter a video prompt');
        return;
      }

      if (isScriptMode && !script) {
        alert('Please enter an ad script');
        return;
      }

      // Submit job
      try {
        const payload = isScriptMode 
          ? { script, duration, aspectRatio }
          : { prompt, duration, aspectRatio };

        const res = await fetch(`${API_BASE}/api/video/generate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (!res.ok) {
          throw new Error(data.error || 'Generation failed');
        }

        // Show job status
        currentJobId = data.jobId;
        startTime = Date.now();
        document.getElementById('job-id').textContent = data.jobId;
        jobStatus.classList.remove('hidden');
        videoResult.classList.add('hidden');

        // Start polling
        pollJob();

      } catch (error) {
        alert(`Error: ${error.message}`);
      }
    });

    // Poll job status
    async function pollJob() {
      if (!currentJobId) return;

      try {
        const res = await fetch(`${API_BASE}/api/video/status/${currentJobId}`);
        const data = await res.json();

        // Update progress
        const progress = data.progress || 0;
        document.getElementById('progress-bar').style.width = `${progress}%`;
        document.getElementById('job-progress').textContent = `${Math.round(progress)}%`;
        document.getElementById('job-status-text').textContent = data.status;

        // Update elapsed time
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById('elapsed-time').textContent = `${elapsed}s`;

        if (data.status === 'completed') {
          // Show video
          showVideo(data.videoUrl);
          stopPolling();
        } else if (data.status === 'failed') {
          alert(`Generation failed: ${data.error}`);
          stopPolling();
          jobStatus.classList.add('hidden');
        } else {
          // Continue polling
          if (!pollInterval) {
            pollInterval = setInterval(pollJob, 3000);
          }
        }

      } catch (error) {
        console.error('Poll error:', error);
      }
    }

    // Show completed video
    function showVideo(videoUrl) {
      document.getElementById('result-video').src = videoUrl;
      document.getElementById('download-video').href = videoUrl;
      jobStatus.classList.add('hidden');
      videoResult.classList.remove('hidden');
      loadRecentVideos();
    }

    // Stop polling
    function stopPolling() {
      if (pollInterval) {
        clearInterval(pollInterval);
        pollInterval = null;
      }
    }

    // Cancel job
    document.getElementById('cancel-job').addEventListener('click', () => {
      stopPolling();
      currentJobId = null;
      jobStatus.classList.add('hidden');
    });

    // Generate another
    document.getElementById('generate-another').addEventListener('click', () => {
      videoResult.classList.add('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Copy URL
    document.getElementById('copy-url').addEventListener('click', () => {
      const videoUrl = document.getElementById('result-video').src;
      navigator.clipboard.writeText(videoUrl);
      alert('Video URL copied!');
    });

    // Load recent videos
    async function loadRecentVideos() {
      try {
        const res = await fetch(`${API_BASE}/api/video?limit=10`);
        const data = await res.json();
        
        const container = document.getElementById('recent-videos');
        
        if (!data.jobs || data.jobs.length === 0) {
          container.innerHTML = '<p class="text-gray-400 text-center py-8">No videos yet. Generate your first one!</p>';
          return;
        }

        container.innerHTML = data.jobs.map(job => `
          <div class="flex items-center justify-between p-4 bg-gray-700 rounded-lg hover:bg-gray-600 cursor-pointer">
            <div class="flex-1">
              <div class="font-medium">${job.params.prompt?.substring(0, 60) || job.params.originalScript?.substring(0, 60)}...</div>
              <div class="text-sm text-gray-400">${new Date(job.createdAt).toLocaleString()}</div>
            </div>
            <div class="text-right">
              <div class="text-sm ${job.status === 'completed' ? 'text-green-500' : job.status === 'failed' ? 'text-red-500' : 'text-yellow-500'}">
                ${job.status}
              </div>
            </div>
          </div>
        `).join('');

      } catch (error) {
        console.error('Failed to load recent videos:', error);
      }
    }

    // Initialize
    checkStatus();
    loadRecentVideos();
  </script>

</body>
</html>
